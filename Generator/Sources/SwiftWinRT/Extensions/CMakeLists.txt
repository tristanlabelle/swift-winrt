# Build the resource embedding code
set(PACKAGERESOURCES_CODE "enum PackageResources {\n")
file(GLOB RESOURCES "*_swift")
foreach(RESOURCE ${RESOURCES})
    get_filename_component(RESOURCE_NAME ${RESOURCE} NAME)
    file(READ ${RESOURCE} RESOURCE_HEX HEX)
    string(REGEX REPLACE "([0-9a-f][0-9a-f])" "0x\\1," RESOURCE_HEX ${RESOURCE_HEX})
    string(APPEND PACKAGERESOURCES_CODE "    static let ${RESOURCE_NAME}: [UInt8] = [ ${RESOURCE_HEX} ]\n")
endforeach()
string(APPEND PACKAGERESOURCES_CODE "}\n")

# Update the file if the code has changed
set(PACKAGERESOURCES_SWIFT_FILE "${CMAKE_CURRENT_BINARY_DIR}/PackageResources.swift")
set(PACKAGERESOURCES_OLD_CODE "")
if(EXISTS "${PACKAGERESOURCES_SWIFT_FILE}")
    file(READ "${PACKAGERESOURCES_SWIFT_FILE}" PACKAGERESOURCES_OLD_CODE)
endif()
if(NOT "${PACKAGERESOURCES_CODE}" STREQUAL "${PACKAGERESOURCES_OLD_CODE}")
    file(WRITE "${PACKAGERESOURCES_SWIFT_FILE}" "${PACKAGERESOURCES_CODE}")
endif()

# Return the path
set(PACKAGERESOURCES_SWIFT_FILE "${PACKAGERESOURCES_SWIFT_FILE}" PARENT_SCOPE)
